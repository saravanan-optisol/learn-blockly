<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
</head>
<body>
    <div id="blocklyDiv" style="height: 550px; width: 1200px;"></div>

    <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
        <category name='define_block'>
            <block type='controls_if'></block>
            <block type='connection'></block>
            <block type='field'></block>
            <block type='ochange'></block>
            <block type='blcol'></block>
            <block type='validator_example'></block>
            <block type='example_angle'></block>
            <block type='example_checkbox'></block>
            <block type='example_colour'></block>
            <block type='example_date'></block>
            <block type='example_dropdown'></block>
            <block type='example_image'></block>
            <block type='example_label'></block>
            <block type='example_number'></block>
            <block type='example_serializable_label'></block>
            <block type='example_textinput'></block>
            <block type='example_variable_typed'></block>
            <block type='example_variable_untyped'></block>
          </category>
    </xml>

    <script>
        //workspace injection
        var demoWorkspace = Blockly.inject('blocklyDiv',{ 
          toolbox: document.getElementById('toolbox')
        });

        Blockly.Msg.EVERYTHING_HUE = 42;

        Blockly.Blocks['connection'] = {
        init: function() {
            //inputs
            this.setInputsInline(true);
            // this.setInputsInline(false);

            //connections
            //left output
            // this.setOutput(true, null);

            //top and bottom connections
            /* 
            this.setPreviousStatement(true, null);
            this.setNextStatement(true, null); */
            
            //top connection
            // this.setPreviousStatement(true, null);

            //bottom connection
            // this.setNextStatement(true, null);  
            //colour
          this.setColour(16);
          this.setTooltip('test the connections');
          this.setHelpUrl('http://www.w3schools.com/jsref/jsref_length_string.asp');
        }
      };

      Blockly.Blocks['field'] = {
        init: function() {
           
            //value input
            /* this.appendValueInput("NAME")
                .setCheck(null);
 */
            //statement input   
            /* this.appendStatementInput("NAME")
                .setCheck(null); */
                
            //dummy input
            // this.appendDummyInput()

            //dummy input with field
            this.appendDummyInput()
                .setAlign(Blockly.ALIGN_RIGHT);

            //append field
            this.appendStatementInput("NAME")
                .setCheck(null)
                .appendField(new Blockly.FieldCheckbox("TRUE"), "dfe");
          this.setColour(16);
          this.setTooltip('test the field');
          this.setHelpUrl('http://www.w3schools.com/jsref/jsref_length_string.asp');
        }
      };

      Blockly.Blocks['ochange'] = {
            init: function() {
                // Example validation upon block change:
               /*  this.setOnChange(function(changeEvent) {
                if (this.getInput('NUM').connection.targetBlock()) {
                    this.setWarningText(null);
                } else {
                    this.setWarningText('Must have an input block.');
                } 
                console.log('ochandlkfji')
                }); */
            }
    }

    Blockly.Blocks['validator_example'] = {
        init: function() {
            // Remove all 'a' characters from the text input's value.
            /* var validator = function(newValue) {
            return newValue.replace(/\a/g, '');
            }; */

            // Any value containing a 'b' character is invalid.  Other values are valid.
            var validator = function(newValue) {
            if (newValue.indexOf('b') != -1) {
                return null;
            }
            return newValue;
            };

            var field = new Blockly.FieldTextInput('default');
            field.setValidator(validator);

            this.appendDummyInput().appendField(field);
        }
        };

        Blockly.Blocks['example_angle'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('angle:')
                    .appendField(new Blockly.FieldAngle(90), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_checkbox'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('checkbox:')
                    .appendField(new Blockly.FieldCheckbox(true), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_colour'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('colour:')
                    .appendField(new Blockly.FieldColour('#ff4040',
                        {
                            "colourOptions":
                            ['#ff4040', '#ff8080', '#ffc0c0',
                            '#4040ff', '#8080ff', '#c0c0ff'],
                            "colourTitles":
                            ['dark pink', 'pink', 'light pink',
                            'dark blue', 'blue', 'light blue'],
                            "columns": 3
                        }), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_date'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('date:')
                    .appendField(new Blockly.FieldDate('2020-02-20'), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_dropdown'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('drop down:')
                    .appendField(new Blockly.FieldDropdown([
                        ['first item', 'ITEM1'],
                        ['second item', 'ITEM2']
                    ]), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_image'] = {
            init: function() {
                this.appendDummyInput()
                .appendField("image:")
                .appendField(new Blockly.FieldImage(
                    "https://www.gstatic.com/codesite/ph/images/star_on.gif",
                    15,
                    15,
                    "*"));
        }
        };

        Blockly.Blocks['example_label'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField(new Blockly.FieldLabel('a label'));
                this.appendDummyInput()
                    .appendField('and another label');
            }
            };

        Blockly.Blocks['example_serializable_label'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField(new Blockly.FieldLabelSerializable("a serializable label"), "FIELDNAME");
            }
            };

        Blockly.Blocks['example_number'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField("number:")
                    .appendField(new Blockly.FieldNumber(100, 0, 100, 10), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_textinput'] = {
        init: function() {
            this.appendDummyInput()
                .appendField("text input:")
                .appendField(new Blockly.FieldTextInput('default text'),
                    'FIELDNAME');
        }
        };

        Blockly.Blocks['example_variable_untyped'] = {
            init: function() {
                this.appendDummyInput()
                    .appendField('variable:')
                    .appendField(new Blockly.FieldVariable('x'), 'FIELDNAME');
            }
            };

        Blockly.Blocks['example_variable_typed'] = {
            init: function() {
                this.appendDummyInput()
                .appendField('variable:')
                .appendField(new Blockly.FieldVariable(
                    'X',
                    null,
                    ['Number', 'String'],
                    'Number'
                ), 'FIELDNAME');
            }
            };
    Blockly.Blocks['blcol'] = {
        init: function() {
            this.appendStatementInput("NAME")
                .setCheck(null)
                .appendField(new Blockly.FieldCheckbox("TRUE"), "dfe");
            this.setColour(16);
            this.setTooltip('test the field');
            this.setHelpUrl('http://www.w3schools.com/jsref/jsref_length_string.asp');
        }
    }

    

    block.setColour('%{BKY_EVERYTHING_HUE}');

      Blockly.JavaScript['connection'] = function(block) {
        // String or array length.
        var argument0 = Blockly.JavaScript.valueToCode(block, 'VALUE',
            Blockly.JavaScript.ORDER_FUNCTION_CALL) || '\'\'';
        return [argument0 + '.length', Blockly.JavaScript.ORDER_MEMBER];
      };  
    </script>
</body>
</html>